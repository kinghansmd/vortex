<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vortex xmd Verification</title>
    <style>
        body {
            background-image: url('https://files.catbox.moe/lvvpzw.jpeg');
            background-size: cover;
            text-align: center;
            color: white;
            font-family: Arial, sans-serif;
        }
        .container {
            margin-top: 50px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            display: inline-block;
            border-radius: 10px;
        }
        input, button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        button {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Fork Verification for Deployment</h2>
        <p>Enter your GitHub username:</p>
        <input type="text" id="username" placeholder="GitHub Username">
        <button onclick="checkUsername()">Next</button>
        <div id="result"></div>
    </div>

    <script>
        function checkUsername() {
            const username = document.getElementById("username").value.trim();
            if (!username) {
                alert("Please enter your GitHub username.");
                return;
            }

            if (username.toLowerCase() === "mrhanstz") {
                document.getElementById("result").innerHTML = `
                    <p>Enter Sudo Password:</p>
                    <input type="password" id="password" placeholder="Enter Password">
                    <button onclick="verifySudo()">Verify</button>
                `;
            } else {
                checkFork(username);
            }
        }

        function verifySudo() {
            const password = document.getElementById("password").value.trim();
            if (password === "Dodoma2006#") {
                document.getElementById("result").innerHTML = `
                    <p>Welcome, Sudo User Mrhanstz! You are verified.</p>
                    <a href="https://dashboard.heroku.com/new?template=https://github.com/Mrhanstz/VORTEX-XMD" target="_blank">
                        <button>Deploy to Heroku</button>
                    </a>
                `;
            } else {
                document.getElementById("result").innerHTML = `
                    <p>You are not Mrhanstz. Enter your GitHub username.</p>
                    <input type="text" id="username" placeholder="GitHub Username">
                    <button onclick="checkUsername()">Next</button>
                    <br><br>
                    <a href="https://wa.me/255756530143" target="_blank">
                        <button>Contact Dev</button>
                    </a>
                `;
            }
        }

        async function checkFork(username) {
            const repoUrl = `https://api.github.com/repos/${username}/VORTEX-XMD`;
            const parentRepo = "Mrhanstz/VORTEX-XMD";

            try {
                const response = await fetch(repoUrl);
                const forkedRepo = await response.json();

                if (response.status === 404 || forkedRepo.message === "Not Found") {
                    document.getElementById("result").innerHTML = `
                        <p>You have not forked the repository.</p>
                        <a href="https://github.com/Mrhanstz/VORTEX-XMD/fork" target="_blank">
                            <button>Fork Repo</button>
                        </a>
                    `;
                    return;
                }

                if (forkedRepo.fork && forkedRepo.parent && forkedRepo.parent.full_name === parentRepo) {
                    const parentSha = await getLatestCommit(parentRepo);
                    const forkSha = await getLatestCommit(`${username}/VORTEX-XMD`);

                    if (parentSha !== forkSha) {
                        document.getElementById("result").innerHTML = `
                            <p>Your fork is outdated. Please sync with the original repo.</p>
                            <a href="https://github.com/${username}/VORTEX-XMD" target="_blank">
                                <button>Sync Fork</button>
                            </a>
                            <br><br>
                            <button onclick="checkFork('${username}')">Re-Verify</button>
                        `;
                    } else {
                        const herokuDeployUrl = `https://dashboard.heroku.com/new?template=https://github.com/${username}/VORTEX-XMD`;
                        document.getElementById("result").innerHTML = `
                            <p>Your fork is up-to-date!</p>
                            <a href="${herokuDeployUrl}" target="_blank">
                                <button>Deploy to Heroku</button>
                            </a>
                        `;
                    }
                } else {
                    document.getElementById("result").innerHTML = "<p>Unexpected error. Please try again.</p>";
                }
            } catch (error) {
                console.error(error);
                document.getElementById("result").innerHTML = "<p>Error fetching data. Try again later.</p>";
            }
        }

        async function getLatestCommit(repo) {
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/commits`);
                const data = await response.json();
                return data[0]?.sha || null;
            } catch (error) {
                console.error("Error fetching commits:", error);
                return null;
            }
        }
    </script>
</body>
</html>
